@page "/Movies"
@inject IRepository _repository

<h3>MoviesList</h3>
<MudCarousel Class="mud-width-full" Style="height:700px;"
             ShowArrows="@arrows" ShowBullets="@bullets"
             EnableSwipeGesture="@enableSwipeGesture" AutoCycle="@autocycle"
             TData="Movies">
    @foreach (var group in Movies.Chunk(4))
    {
        <MudCarouselItem>
            @foreach (var movies in group)
            {
                <MudImage Src="@movies.Cover" Width="300" Height="550" />
            }
        </MudCarouselItem>
    }
</MudCarousel>

<MudTable Items="@Movies" Virtualize="true">
    <HeaderContent>
        <MudTh>Cover</MudTh>
        <MudTh>Title</MudTh>
        <MudTh>Description</MudTh>
        <MudTh>Classification</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd><img src="@context.Cover" width="100" height="100" alt="Descripción de la imagen" /></MudTd>
        <MudTd>@context.Title</MudTd>
        <MudTd>@context.Description</MudTd>
        <MudTd>@context?.IdClassificationNavigation?.Name</MudTd>
        <MudButton Variant="Variant.Filled" EndIcon="@Icons.Material.Filled.Update" Color="Color.Primary" Href="@($"UpdateMovie/{context.IdMovie}")" ButtonType="ButtonType.Submit">Edit</MudButton>
    </RowTemplate>
</MudTable>

@code {
    private List<Movies> Movies { get; set; }


    private bool arrows = true;
    private bool bullets = false;
    private bool enableSwipeGesture = true;
    private bool autocycle = true;
    private Transition transition = Transition.Slide;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var response = await _repository.Get<List<Movies>>("api/Movies");
            if (response.Error)
            {
                Console.WriteLine(response.GetBody());
            }
            else if (response.Response != null)
            {
                Movies = response.Response;
                StateHasChanged();
            }
        }
        catch (Exception ex)
        {
            // Manejar el error de alguna manera, por ejemplo, mostrar un mensaje de error en la página
        }
    }
}
